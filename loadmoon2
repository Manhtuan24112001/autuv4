fask = task
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local actualHour = os.date("!*t").hour

-- HÃ m kiá»ƒm tra pha máº·t trÄƒng
local function GetMoonPhase()
	local moonTextures = {
		["http://www.roblox.com/asset/?id=9709149431"] = "Full Moon ðŸŒ•",
		["http://www.roblox.com/asset/?id=9709149052"] = "87,5%",
		["http://www.roblox.com/asset/?id=9709143733"] = "75%",
		["http://www.roblox.com/asset/?id=9709150401"] = "62,5%",
		["http://www.roblox.com/asset/?id=9709135895"] = "50%",
		["http://www.roblox.com/asset/?id=9709139597"] = "37,5%",
		["http://www.roblox.com/asset/?id=9709150086"] = "25%",
		["http://www.roblox.com/asset/?id=9709149680"] = "12,5%"
	}

	local textureId = game:GetService("Lighting").Sky.MoonTextureId
	if moonTextures[textureId] then
		print("ðŸŒ™ Pha máº·t trÄƒng hiá»‡n táº¡i: " .. moonTextures[textureId])
		if textureId == "http://www.roblox.com/asset/?id=9709149431" or -- Full Moon
		   textureId == "http://www.roblox.com/asset/?id=9709149052" or -- 87.5%
		   textureId == "http://www.roblox.com/asset/?id=9709143733" then -- 75%
			return "Full Moon ðŸŒ•"
		end
		return moonTextures[textureId]
	else
		print("ðŸŒ™ KhÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c pha máº·t trÄƒng")
		return nil
	end
end

function TPFromSavedJob()
	local success, content = pcall(function()
		return readfile("helpfullmoon.json")
	end)

	if success and content and content ~= "" then
		local data = HttpService:JSONDecode(content)
		if typeof(data) == "table" and #data > 0 then
			local job = data[1]
			local jobId = tostring(job.jobId)
			local playerCount = tonumber(job.playerCount or 0)
			local maxPlayers = 12

			-- Kiá»ƒm tra Full Moon
			local moonPhase = GetMoonPhase()

			if playerCount < maxPlayers and moonPhase == "Full Moon ðŸŒ•" then
				print("âœ… Äang tiáº¿n hÃ nh join server Full Moon...")
				fask.wait()

				-- XÃ³a dá»¯ liá»‡u trong helpfullmoon.json sau khi Ä‘Ã£ teleport
				writefile("helpfullmoon.json", HttpService:JSONEncode({}))

				pcall(function()
					local args = {
						[1] = "teleport",
						[2] = jobId
					}
					game:GetService("ReplicatedStorage").__ServerBrowser:InvokeServer(unpack(args))
				end)

				fask.wait(0.5)
			else
				print("â© Bá» qua do khÃ´ng pháº£i Full Moon hoáº·c server Ä‘Ã£ vÃ o.")
			end
		else
			warn("âš ï¸ Dá»¯ liá»‡u trong helpfullmoon.json khÃ´ng há»£p lá»‡.")
		end
	else
		warn("âŒ KhÃ´ng thá»ƒ Ä‘á»c file helpfullmoon.json.")
	end
end

-- Gá»i liÃªn tá»¥c Ä‘á»ƒ kiá»ƒm tra vÃ  join náº¿u phÃ¹ há»£p
fask.spawn(function()
	while true do
		pcall(TPFromSavedJob)
		fask.wait(5)
	end
end)
